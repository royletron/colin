{"ts":1369232118000,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// Validators, helpers\n//\n\n// Trim Input\nfunction trimInput(val) {\n  return val.replace(/^\\s*|\\s*$/g, \"\");\n}\n\n// Validations\nfunction isEmail(val, field) {\n  if (val.indexOf('@') !== -1) {\n      return true;\n    } else {\n      Session.set('displayMessage', 'Error & Please enter a valid email address.');\n      return false;\n    }\n}\n\nfunction isValidPassword(val, field) {\n  if (val.length >= 6) {\n    return true;\n  } else {\n    Session.set('displayMessage', 'Error & Your password should be 6 characters or longer.');\n    return false;\n  }\n}\n\nfunction isNotEmpty(val, field) {\n  // if null or empty, return false\n  if (!val || val === ''){\n    Session.set('displayMessage', 'Error & Please fill in all required fields.');\n    return false;\n  }\n  return true;\n}\n\n// Login Form Helpers\nTemplate.loginForm.helpers({\n\n  loginForm: function(){\n    if (!Session.get('formView'))\n      return true;\n  },\n\n  createAccount: function(){\n    return Session.equals('formView', 'createAccountForm');\n  },\n\n  passwordRecovery: function(){\n    return Session.equals('formView', 'passwordRecoveryForm');\n  }\n\n});\n\n// On successful login, hide the overlay button. And\n// if we are in the create project flow, then create\n// the project and move to the project view.\nfunction onLogin(err){\n  if (err) {\n    Session.set('displayMessage', 'Login Error &' + err.reason);\n    return;\n  }\n\n  if (Session.get('createProjectFlow'))\n    createProject();\n\n  Session.set('overlay', null);\n}\n\n// Create a project if we are in 'createProjectFlow'.\nfunction createProject(){\n  var videoObject = Session.get('createProjectFlow');\n\n  var newProject = {\n    user: Meteor.userId(),\n    created: new Date(),\n    type: videoObject.type,\n    url : videoObject.url\n  };\n\n  if (videoObject.type === 'html') {\n    newProject.name = videoObject.name;\n  }\n\n  // actually insert new object into database\n  var newVideo = Videos.insert(newProject);\n  Router.navigate('project/' + newVideo);\n\n  delete Subtitler.videoNode;\n  Session.set('currentVideo', newVideo);\n  Session.set('loadingError', null);\n  Session.set('currentView', 'app');\n  Session.set('createProjectFlow', null);\n}\n\n\n// Login Form Events\nTemplate.loginForm.events({\n\n  'submit #login-form' : function(e, t) {\n    e.preventDefault();\n    var email = trimInput(t.find('#login-email').value.toLowerCase())\n      , password = t.find('#login-password').value;\n\n    if (isNotEmpty(email, 'loginError')\n        && isNotEmpty(password, 'loginError'))\n    {\n      Meteor.loginWithPassword(email, password, function(err){\n        onLogin(err);\n      });\n    }\n\n    return false;\n  },\n\n  'click #forgot-password' : function(e, t) {\n    Session.set('formView', 'passwordRecoveryForm');\n  },\n\n  'click #create-account' : function(e, t) {\n    Session.set('formView', 'createAccountForm');\n  },\n\n  'click a.google' : function(e, t){\n    Meteor.loginWithGoogle(function(err){\n      onLogin(err);\n    });\n  },\n\n  'click a.facebook' : function(e, t){\n    Meteor.loginWithFacebook(function(err){\n     onLogin(err);\n    });\n  },\n\n  'click a.twitter' : function(e, t){\n    Meteor.loginWithTwitter(function(err){\n      onLogin(err);\n    });\n  }\n\n});\n\n// Reset our Session variables when the template\n// is destroyed.\nTemplate.loginForm.destroyed = function(){\n  Session.set('formView', null);\n};\n\n// Create an account and login the user.\nTemplate.createAccountForm.events({\n\n  'submit #register-form' : function(e, t) {\n    var email = trimInput(t.find('#account-email').value.toLowerCase())\n      , password = t.find('#account-password').value;\n\n    if (isNotEmpty(email, 'accountError')\n        && isNotEmpty(password, 'accountError')\n        && isEmail(email, 'accountError')\n        && isValidPassword(password, 'accountError'))\n    {\n      Session.set('loading', true);\n      Accounts.createUser({email: email, password : password}, function(err){\n        if (err && err.error === 403) {\n          Session.set('displayMessage', 'Account Creation Error &' + err.reason);\n          Session.set('loading', false);\n        } else {\n          if (Session.get('createProjectFlow')) createProject();\n          Session.set('overlay', null);\n        }\n        Session.set('loading', false);\n      });\n    }\n    return false;\n  }\n\n});\n\nTemplate.passwordRecoveryForm.helpers({\n\n  resetToken: function(){\n    return Session.get('resetPassword');\n  }\n\n});\n\nTemplate.passwordRecoveryForm.events({\n\n  'submit #recovery-form' : function(e, t) {\n      var email = trimInput(t.find('#recovery-email').value);\n      if (isNotEmpty(email, 'recoveryError') && isEmail(email, 'recoveryError')) {\n        Session.set('loading', true);\n        Accounts.forgotPassword({email: email}, function(err){\n        if (err)\n          Session.set('displayMessage', 'Password Reset Error & ' + err.reason);\n        else {\n          Session.set('displayMessage', 'Email Sent & Please check your email to reset your password.');\n          Session.set('passwordView', null);\n          Router.navigate('');\n        }\n        Session.set('loading', false);\n      });\n      }\n      return false;\n    },\n\n    'submit #new-password' : function(e, t) {\n      var pw = t.find('#new-password-password').value;\n      if (isNotEmpty(pw) && isValidPassword(pw)) {\n        Session.set('loading', true);\n        Accounts.resetPassword(Session.get('resetPassword'), pw, function(err){\n          if (err)\n            Session.set('displayMessage', 'Password Reset Error & '+ err.reason);\n          else {\n            Session.set('currentView', 'library');\n            Session.set('resetPassword', null);\n            Router.navigate('library');\n          }\n          Session.set('loading', false);\n        });\n      }\n    return false;\n    }\n});"]],"start1":0,"start2":0,"length1":0,"length2":5697}]],"length":5697}
{"contributors":[],"silentsave":false,"ts":1369233672311,"patch":[[{"diffs":[[0,"\n}\n\n"],[-1,"// Create a project if we are in 'createProjectFlow'.\nfunction createProject(){\n  var videoObject = Session.get('createProjectFlow');\n\n  var newProject = {\n    user: Meteor.userId(),\n    created: new Date(),\n    type: videoObject.type,\n    url : videoObject.url\n  };\n\n  if (videoObject.type === 'html') {\n    newProject.name = videoObject.name;\n  }\n\n  // actually insert new object into database\n  var newVideo = Videos.insert(newProject);\n  Router.navigate('project/' + newVideo);\n\n  delete Subtitler.videoNode;\n  Session.set('currentVideo', newVideo);\n  Session.set('loadingError', null);\n  Session.set('currentView', 'app');\n  Session.set('createProjectFlow', null);\n}\n\n\n"],[0,"// L"]],"start1":1462,"start2":1462,"length1":682,"length2":8}]],"length":5023,"saved":false}
{"ts":1369234384963,"patch":[[{"diffs":[[0,"rr.reason);\n"],[1,"    console.log(err.reason);\n"],[0,"    return;\n"]],"start1":1340,"start2":1340,"length1":24,"length2":53}]],"length":5052,"saved":false}
{"ts":1369234489587,"patch":[[{"diffs":[[0,"ssword').value;\n"],[1,"    console.log(email+\":\"+password);"],[0,"\n    if (isNotEm"]],"start1":1717,"start2":1717,"length1":32,"length2":68}]],"length":5088,"saved":false}
{"contributors":[],"silentsave":false,"ts":1369252227308,"patch":[[{"diffs":[[0," if (err) {\n"],[1,"    message(\"Login Error\", err.reason, ERROR_MESSAGE);\n"],[0,"    Session."]],"start1":1275,"start2":1275,"length1":24,"length2":79},{"diffs":[[0,"n);\n"],[-1,"    console.log(err.reason);\n"],[0,"    "]],"start1":1403,"start2":1403,"length1":37,"length2":8}]],"length":5114,"saved":false}
{"ts":1369252253512,"patch":[[{"diffs":[[0,"E);\n"],[-1,"    Session.set('displayMessage', 'Login Error &' + err.reason);\n"],[0,"    "]],"start1":1338,"start2":1338,"length1":73,"length2":8}]],"length":5049,"saved":false}
{"ts":1369252313134,"patch":[[{"diffs":[[0,"    "],[-1,"Session.set('displayMessage'"],[1,"message(\"Login Error\""],[0,", 'E"]],"start1":642,"start2":642,"length1":36,"length2":29},{"diffs":[[0,"fields.'"],[1,", ERROR_MESSAGE"],[0,");\n    r"]],"start1":706,"start2":706,"length1":16,"length2":31}]],"length":5057,"saved":false}
{"ts":1369252385581,"patch":[[{"diffs":[[0,"'){\n    "],[-1,"message(\"Login Error\""],[1,"Session.set('displayMessage'"],[0,", 'Error"]],"start1":638,"start2":638,"length1":37,"length2":44},{"diffs":[[0,"fields.'"],[-1,", ERROR_MESSAGE"],[0,");\n    r"]],"start1":713,"start2":713,"length1":31,"length2":16},{"diffs":[[0,"SSAGE);\n"],[1,"    Session.set('displayMessage', 'Login Error &' + err.reason);\n"],[0,"    retu"]],"start1":1334,"start2":1334,"length1":16,"length2":81}]],"length":5114,"saved":false}
{"ts":1369252527961,"patch":[[{"diffs":[[0,") {\n"],[-1,"    message(\"Login Error\", err.reason, ERROR_MESSAGE);\n"],[0,"    "]],"start1":1283,"start2":1283,"length1":63,"length2":8}]],"length":5059,"saved":false}
{"ts":1369252821135,"patch":[[{"diffs":[[0,".toLowerCase())\n"],[1,"      , username = t.find('#account-username').value;\n"],[0,"      , password"]],"start1":2839,"start2":2839,"length1":32,"length2":86},{"diffs":[[0,".value;\n"],[-1,""],[0,"\n    if "]],"start1":2955,"start2":2955,"length1":16,"length2":16},{"diffs":[[0,"'accountError')\n"],[1,"        && isNotEmpty(username, 'accountError')\n"],[0,"        && isVal"]],"start1":3080,"start2":3080,"length1":32,"length2":80},{"diffs":[[0,"ng', true);\n"],[-1,""],[0,"      Accoun"]],"start1":3228,"start2":3228,"length1":24,"length2":24},{"diffs":[[0,"mail: email,"],[1," username: username,"],[0," password : "]],"start1":3268,"start2":3268,"length1":24,"length2":44}]],"length":5181,"saved":false}
{"ts":1369253143836,"patch":[[{"diffs":[[0,"name').value"],[-1,";"],[0,"\n      , pas"]],"start1":2895,"start2":2895,"length1":25,"length2":24}]],"length":5180,"saved":false}
